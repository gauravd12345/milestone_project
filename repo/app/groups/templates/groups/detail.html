{% extends "base.html" %}
{% block title %}{{ group.name }} – Study Group{% endblock %}

{% block breadcrumb %}
<nav class="text-xs text-slate-500 flex items-center gap-1 mb-2">
  <a href="{{ url_for('main.index') }}" class="hover:text-slate-700">Home</a>
  <span>/</span>
  <a href="{{ url_for('groups.list_groups') }}" class="hover:text-slate-700">Study Groups</a>
  <span>/</span>
  <span class="font-medium text-slate-700">{{ group.name }}</span>
</nav>
{% endblock %}

{% block content %}
<div class="mb-5">
  <h1 class="text-xl font-semibold text-slate-900">{{ group.name }}</h1>
  <p class="text-sm text-slate-500 mt-1">
    {{ group.description or "No description provided for this group." }}
  </p>
</div>

<div class="grid grid-cols-1 md:grid-cols-2 gap-5 mb-6">
  {# Members list #}
  <section class="bg-white border border-slate-200 rounded-lg p-4 shadow-sm">
    <h2 class="text-sm font-semibold text-slate-800 mb-3">Members</h2>
    <ul class="divide-y divide-slate-100">
      {% for member in members %}
        <li class="flex items-center justify-between py-2">
          <div>
            <p class="text-sm text-slate-800">{{ member.email }}</p>
            {% if member.id == group.owner_id %}
              <p class="text-xs text-slate-500">Group owner</p>
            {% endif %}
          </div>
          <div>
            {% if member.id != current_user.id %}
              <a
                href="{{ url_for('groups.view_group', group_id=group.id, to=member.id) }}"
                class="inline-flex items-center px-2.5 py-1.5 rounded-md border border-blue-600 text-blue-700 text-xs font-medium hover:bg-blue-50"
              >
                Nudge
              </a>
            {% else %}
              <span class="inline-flex items-center px-2.5 py-1.5 rounded-md bg-slate-100 text-slate-700 text-xs font-medium">
                You
              </span>
            {% endif %}
          </div>
        </li>
      {% endfor %}
    </ul>
  </section>

  {# Nudge form #}
  <section class="bg-white border border-slate-200 rounded-lg p-4 shadow-sm">
    <h2 class="text-sm font-semibold text-slate-800 mb-3">Send Nudge</h2>

    {% if target_user %}
      <p class="text-xs text-slate-600 mb-3">
        Nudging <span class="font-medium">{{ target_user.email }}</span>
      </p>
      <form method="post" class="space-y-3">
        {{ nudge_form.hidden_tag() }}

        <div>
          {{ nudge_form.message.label(class="block text-sm font-medium text-slate-700 mb-1") }}
          {{ nudge_form.message(
              class="w-full rounded-md border border-slate-300 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",
              placeholder="Optional message (e.g., 'Let’s finish our goals this week!')"
          ) }}
          {% for error in nudge_form.message.errors %}
            <p class="mt-1 text-xs text-red-600">{{ error }}</p>
          {% endfor %}
        </div>

        <div class="flex justify-end">
          {{ nudge_form.submit(
              class="inline-flex items-center px-4 py-2 rounded-md bg-blue-600 text-white text-sm font-medium hover:bg-blue-700"
          ) }}
        </div>
      </form>
    {% else %}
      <p class="text-sm text-slate-500">
        Select a member from the list on the left to send them a nudge.
      </p>
    {% endif %}
  </section>
</div>

{# Recent nudges #}
<section class="bg-white border border-slate-200 rounded-lg p-4 shadow-sm">
  <h2 class="text-sm font-semibold text-slate-800 mb-3">Recent Nudges</h2>

  {% if nudges %}
    <ul class="divide-y divide-slate-100">
      {% for n in nudges %}
        <li class="py-2">
          <p class="text-sm text-slate-800">
            <span class="font-medium">{{ n.sender.email }}</span>
            nudged
            <span class="font-medium">{{ n.recipient.email }}</span>
            <span class="text-xs text-slate-500">
              – {{ n.created_at.strftime("%Y-%m-%d %H:%M") }}
            </span>
          </p>
          {% if n.message %}
            <p class="text-xs text-slate-600 mt-1">
              “{{ n.message }}”
            </p>
          {% endif %}
        </li>
      {% endfor %}
    </ul>
  {% else %}
    <p class="text-sm text-slate-500">
      No nudges have been sent in this group yet.
    </p>
  {% endif %}
</section>
{% endblock %}
